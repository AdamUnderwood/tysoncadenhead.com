<!DOCTYPE html>
<!--[if IE 6]>
    <html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
    <html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
    <html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
    <html lang="en-US">
<!--<![endif]-->
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=400, initial-scale=0.5">
        <meta name="google-site-verification" content="AeV4w7EOhEv3lU1OT8KOM7jRS0C6jDAsZyMaG38t1g4" />
        <meta property="og:image" content="http://www.tysoncadenhead.com/images/blog/angular-controllers-with-sails-app.png"/>
        <meta property="og:title" content="Angular Controllers"/>
        <meta property="og:url" content="http://www.tysoncadenhead.com"/>
        <meta property="og:site_name" content="Tyson Cadenhead"/>
        <meta property="og:description" content="Thoughts on productivity, web apps and JavaScript" />
        <title>Angular Controllers</title>
        <link rel="shortcut icon" href="/images/favicon.ico" /> 
        <link rel="stylesheet" href="/css/app.css" />
        <link rel="alternate" type="application/rss+xml" title="Angular Controllers Thoughts on productivity, web apps and JavaScript" href="http://www.tysoncadenhead.com/feed.xml" />
        
    </head>
    <body>
        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-19696495-1']);
          _gaq.push(['_trackPageview']);
        
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        
        </script>
        <div id="fb-root"></div>
        <div class="header" id="top">
            <div class="container">
                <div class="span12">
                    <div class="span4 left">
                        <h1 id="logo"><a href="/"><img src="/images/logo.png" /></a></h1>
                    </div>
                    <div class="span6 right">
                        <div class="navbar navbar-inverse">
                            <div class="navbar-inner right">
                                <ul class="nav right">
                                  <li><a href="/">Blog</a></li>
                                  <li><a href="/presentations">Presentations</a></li>
                                  <li><a href="/about">About Me</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="span12">
                
                    
                    
                        
                        <article>

    <div class="well span2 right thumbnail">
      <img src="/images/blog/angular-controllers-with-sails-app.png" />
    </div>

    <h1>Angular Controllers</h1>

    
      <h4>
        Creating An Application With Sails, Angular and Require.js (part 5)
      </h4>
    

    <h5><span class="label label-info"><a href="/?category=code">code</a></span> | 6-12-2014</h5>

    <div class="series-placement">

    This is part 5 of the <a href="/blog/sails-ninja-intro">Creating An Application With Sails, Angular and Require.js</a> blog series. If you haven&#39;t read the introduction yet, you may want to start there.

    <h4><a href="/blog/adding-dependencies">Previous Post In This Series</a> | <a href="/blog/sails-models">Next Post In This Series</a></h4>

</div>

<p>In the past few posts, I&#39;ve been laying the groundwork for building an Angular application on top of Sails. Now that everything is in place, we can jump right in to adding Angular views.</p>
<!-- more -->

<h3>Create the List Route</h3>
<p>First, we will generate a new controller and model called &quot;list&quot;:</p>
<pre><code class="language-bash">sails generate list</code></pre>
<p>Next, we will add a link to the list page in our layout.ejs file:</p>
<pre><code class="language-html">&lt;li class=&quot;&lt;% if (title === &#39;List&#39;) { %&gt;active&lt;% } %&gt;&quot;&gt;
  &lt;%- link_to(&#39;List&#39;, &#39;/list&#39;) %&gt;
&lt;/li&gt;</code></pre>
<p>Now, if we open our <code>/api/controllers/ListController.js</code> file, we can add a method to render the index page:</p>
<pre><code class="language-js">module.exports = {
  index: function (req, res) {
    res.view(null, {
        title: &#39;List&#39;
    });
  },
  _config: {}
};</code></pre>
<p>Finally, we will create a view for the lists in <code>/views/list/index.ejs</code>:</p>
<pre><code class="language-html">&lt;ul class=&quot;checklist&quot;&gt;
    &lt;li&gt;
        &lt;input type=&quot;checkbox&quot; checked /&gt; Do a thing
    &lt;/li&gt;
    &lt;li&gt;
        &lt;input type=&quot;checkbox&quot; /&gt; Do another thing
    &lt;/li&gt;
    &lt;li&gt;
        &lt;input type=&quot;checkbox&quot; /&gt; Do a third thing
    &lt;/li&gt;
&lt;/ul&gt;

&lt;button class=&quot;btn btn-primary&quot;&gt;Add&lt;/button&gt;
&lt;button class=&quot;btn btn-danger&quot;&gt;Remove&lt;/button&gt;</code></pre>
<h3>Add the Angular Controller</h3>
<p>Now that we&#39;ve got the view rendering for our list, we can add an Angular controller to it.</p>
<p>We will update the markup for the <code>views/list/index.ejs</code> template to use Angular:</p>
<pre><code class="language-html">&lt;div ng-controller=&quot;ListCtrl&quot;&gt;
    &lt;ul class=&quot;checklist&quot;&gt;
        &lt;li ng-repeat=&quot;item in items&quot;&gt;
            &lt;input type=&quot;checkbox&quot; ng-checked=&quot;item.completed&quot; /&gt; &lt;span ng-bind=&quot;item.description&quot;&gt;&lt;/span&gt;
        &lt;/li&gt;
    &lt;/ul&gt;

    &lt;button class=&quot;btn btn-primary&quot; ng-click=&quot;addItem&quot;&gt;Add&lt;/button&gt;
    &lt;button class=&quot;btn btn-danger&quot; ng-click=&quot;removeItems&quot;&gt;Remove&lt;/button&gt;
&lt;/div&gt;</code></pre>
<p>The Angular bindings to take note of are the <code>ng-controller</code>. That will bind everything inside of it to the context of the controller we specified. Next, there is the <code>ng-repeat</code>, which loops over items in the scope.</p>
<p>Now that we&#39;ve added the controller to the markup, we need to actually create the controller in JavaScript. Let&#39;s look at our <code>/assets/js/app.js</code> file. We&#39;ll need it to update it to look like this:</p>
<pre><code class="language-js">define([
  &#39;angular&#39;,
  &#39;sails.io&#39;,
  &#39;controllers&#39;
], function (angular, io) {

  var socket = io.connect(), app;

  socket.on(&#39;connect&#39;, function socketConnected() {
    console.log(&#39;Socket is now connected&#39;);
  });

  app = angular.module(&#39;todoIt&#39;, [
    &#39;controllers&#39;
  ]);

  return app;

});</code></pre>
<p>Basically, we are requiring a JavaScript file which we haven&#39;t created yet called <code>controllers.js</code>. We are also adding a &quot;controllers&quot; module to our application.</p>
<p>Now that we&#39;ve got that in place, let&#39;s create the <code>/assets/js/controllers.js</code> file:</p>
<pre><code class="language-js">define(function (require) {

  var angular = require(&#39;angular&#39;),
      Controllers = angular.module(&#39;controllers&#39;, []);

  Controllers.controller(&#39;ListCtrl&#39;, require(&#39;controllers/listCtrl&#39;));

  return Controllers;

});</code></pre>
<p>The great thing about the way we&#39;ve set up this file is that anytime we need to add a new controller, it&#39;s as simple as adding one new line. This will require the controller and initialize it.</p>
<p>Now, we&#39;ll need to create a new directory at <code>/assets/js/controllers</code>. Inside our new folder, we&#39;ll make a file named <code>listCtrl.js</code>. The listCtrl.js file should look like this:</p>
<pre><code class="language-js">define(function () {
    return [&#39;$scope&#39;, function($scope) {
        $scope.addItem = function () {
            console.log(&#39;addItem&#39;);
        };
        $scope.removeItems = function () {
            console.log(&#39;removeItems&#39;);
        };
        $scope.items = [{
            description: &#39;Do a thing&#39;,
            completed: true
        }, {
            description: &#39;Do another thing&#39;,
            completed: false
        }, {
            description: &#39;Do a third thing&#39;,
            completed: false
        }];
    }];
});</code></pre>
<p>So there we go. Each of our controller AMD modules will just return an array with the dependencies as the items in the array and a function as the last item, just like a regular Angular controller except the controller is being initialized in the controller.js file, not on an individual module basis.</p>
<p>We are adding an array of &quot;items&quot; to the <code>$scope</code>. We also went ahead and stubbed out a couple of methods for the buttons. They&#39;ll just do a console.log for now, but we&#39;ll get them working soon.</p>
<p>Now we have Angular controllers on top of our Sails app. At this point, the app should look something like this:</p>
<p><img src="/images/blog/angular-controllers-with-sails-app2.png" alt=""></p>
<p>Next time we&#39;ll start getting real data on the app.</p>
<p>If you want to see the point our sample app should be at by now, check out the Github repo <a href="https://github.com/tysoncadenhead/sails-angular-example-app/tree/12d1e1860f0c1ae5acead7f6011059ce6b637375">at this point</a>.</p>


    <h5>Tags: 
    
        <span class="label">
            <a href="/?tag=angular">angular</a>
        </span>
    
    </h5>

    <br />

    <div class="google-things">

        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <ins class="adsbygoogle"
       style="display:block"
       data-ad-client="ca-pub-5130799763611680"
       data-ad-slot="1525472392"
       data-ad-format="auto"></ins>
  <script>
  (adsbygoogle = window.adsbygoogle || []).push({});
  </script>

    </div>

    <br />

</article>

<div class="share">
    <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'tysoncadenhead';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                    
                
            </div>
        </div>
        <script data-main="/js/app.js" src="/js/vendor/require.js"></script>
        <div class="footer">
                <div class="container">
                    <div class="addthis_default_style span12 addthis_32x32_style">
                        <a class="addthis_button_facebook_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_twitter_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_linkedin_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_google_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_youtube_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_flickr_follow" addthis:userid="tysonlloydcadenhead"></a>
                        <a class="addthis_button_instagram_follow" addthis:userid="112101485541389007178"></a>
                    </div>
                    <div class="span12" id="twitter-feed">
                        <a class="twitter-timeline" href="https://twitter.com/tysoncadenhead" data-widget-id="377141114454564864">Tweets by @tysoncadenhead</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                        <script type="text/javascript">
                            window.tysonJS = {
                                slug: ''
                            };
                        </script>
                    </div>
                </div>
        </div>
    </body>
</html>