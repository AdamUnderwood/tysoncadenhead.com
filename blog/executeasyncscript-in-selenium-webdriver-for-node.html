<!DOCTYPE html>
<!--[if IE 6]>
    <html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
    <html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
    <html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
    <html lang="en-US">
<!--<![endif]-->
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
        <meta name="google-site-verification" content="AeV4w7EOhEv3lU1OT8KOM7jRS0C6jDAsZyMaG38t1g4" />
        <meta property="og:image" content="http://www.tysoncadenhead.com/images/blog/selenium.png"/>
        <meta property="og:title" content="executeAsyncScript() in Selenium Webdriver for Node"/>
        <meta property="og:url" content="http://www.tysoncadenhead.com"/>
        <meta property="og:site_name" content="Tyson Cadenhead"/>
        <meta property="og:description" content="Thoughts on productivity, web apps and JavaScript" />
        <title>executeAsyncScript() in Selenium Webdriver for Node</title>
        <link rel="shortcut icon" href="/images/favicon.ico" /> 
        <link rel="stylesheet" href="/css/app.css" />
        <link rel="alternate" type="application/rss+xml" title="executeAsyncScript() in Selenium Webdriver for Node Thoughts on productivity, web apps and JavaScript" href="http://www.tysoncadenhead.com/feed.xml" />
        
    </head>
    <body>
        <script type="text/javascript">

          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-19696495-1']);
          _gaq.push(['_trackPageview']);
        
          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        
        </script>
        <div id="fb-root"></div>
        <div class="header" id="top">
            <div class="container">
                <div class="span12">
                    <div class="span4 left">
                        <h1 id="logo"><a href="/"><img src="/images/logo.png" /></a></h1>
                    </div>
                    <div class="span6 right">
                        <div class="navbar navbar-inverse">
                            <div class="navbar-inner right">
                                <ul class="nav right">
                                  <li><a href="/">Blog</a></li>
                                  <li><a href="/presentations">Presentations</a></li>
                                  <li><a href="/about">About Me</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="span12">
                
                    
                    
                        
                        <article>

    <div class="well span2 right thumbnail">
      <img src="/images/blog/selenium.png" />
    </div>

    <h1>executeAsyncScript() in Selenium Webdriver for Node</h1>

    

    <h5><span class="label label-info"><a href="/?category=code">code</a></span> | 3-22-2013</h5>

    <p>If you aren&#39;t familiar with it, the <a href="https://code.google.com/p/selenium/wiki/WebDriverJs">NodeJS version of the Selenium WebDriver</a> is a great way to write functional tests in JavaScript and automatically run them in your browsers.</p>
<!-- more -->

<p>The NodeJS WebDriver uses the <a href="https://code.google.com/p/selenium/downloads/list">Selenium Server</a> Java jar under the covers to work its magic.</p>
<p>The main downside of the WebDriver is that the documentation is inconclusive at best. I haven&#39;t been able to locate a unified list of the WebDriver methods anywhere on the internet. I&#39;m not even kidding. The best that I have been able to do is look at the Java documentation and make assumptions based it.</p>
<p>My main struggle was finding a way to execute asynchronous JavaScript in a browser and send a callback to the server-side testing suite once the script had finished manipulating the DOM or running Ajax calls. The solution I was finally able to locate was the executeAsyncScript() method.</p>
<p>I wrote my unit tests using <a href="http://visionmedia.github.com/mocha/">Mocha</a>. The code below is what I used to kick off the testing suite. Note that you will need to install the <a href="https://code.google.com/p/selenium/downloads/list">Java jar file</a> and open it, install the <a href="https://code.google.com/p/selenium/downloads/list">Crome driver</a> and open it and of course install the <a href="https://npmjs.org/package/selenium-webdriver&quot;">&quot;selenium-webdriver&quot;</a> and <a href="https://npmjs.org/package/assert">&quot;assert&quot;</a> packages with npm before any of this will work.</p>
<pre><code class="language-javascript">var webdriver = require(&#39;selenium-webdriver&#39;),
    assert = require(&#39;assert&#39;),
    driver;

driver = new webdriver.Builder().usingServer(&#39;http://localhost:4444/wd/hub&#39;).withCapabilities({
   &#39;browserName&#39;: &#39;chrome&#39;
}).build();</code></pre>
<p>Now that our webdriver is working, we just need to kick off our tests.</p>
<pre><code class="language-javascript">// describe() is from Mocha
describe(&quot;Open the webpage&quot;, function () {

   // This makes the WebDriver navigate to the page you want to test
   driver.get(&quot;http://mywebsite.com/mypage&quot;);

   // it() is for Mocha testing
   it(&quot;Should open do my asynchronous bidding&quot;, function (done) {

      // By default, Mocha&#39;s timeout is only a couple of seconds,
      // which is usually too short for asynchronous calls
      this.timeout(500000);

      // driver.executeAsyncScript() allows us to run a script in the browser
      driver.executeAsyncScript(

      // Everything inside here will be executed by the browser, not the server
      function (secondValue) {

        // This is the callback function we can call when everything is done
        var cb = arguments[ arguments.length - 1 ];

        // We&#39;ll use setTimeout() to make the script
        // wait before calling the callback
        setTimeout(function () {
           cb({
              firstValue: 1,
              secondValue: secondValue
           });
        }, 3000);

      },

      // You can pass variables from the server-side to the client-side 
      // by making them additional arguments
      &#39;My Second Value&#39;

      // This is the callback that is fired when the
      // script is done executing in the browser
      ).then(function (obj) {
         assert.equal(obj.firstValue, 1);
         assert.equal(obj.secondValue, &#39;My Second Value&#39;);
         done();
      });

   });
});</code></pre>
<p>As you can see, using the executeAsyncScript() method can be invaluable.</p>
<p>Have you played around with the Node Selenium WebDriver yet? What do you think of it?</p>


    <br /><br />

    <div class="bio">
      <div class="span2">
        <img src="http://profile.ak.fbcdn.net/hprofile-ak-frc3/c0.0.828.828/s480x480/972098_667223423562_1734574442_n.jpg" class="lazy" />
      </div>
      <div class="span8">
        <h3><a href="/about">About the Author</a></h3>
        <p><strong>Tyson Cadenhead</strong> is a JavaScript engineer at <a href="http://appendto.com">appendTo</a>. He lives in the greater Nashville area. His specialty is writing large, scalable JavaScript applications on the client and server side. His passions are for good design, usability, and clean, reusable code.</p>
      </div>
    </div>

    <h5>Tags: 
    
        <span class="label">
            <a href="/?tag=Testing">Testing</a>
        </span>
    
        <span class="label">
            <a href="/?tag=Selenium">Selenium</a>
        </span>
    
    </h5>

</article>

<div class="share">
    <div class="addthis_toolbox addthis_default_style addthis_32x32_style">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
    </div>
</div>

<div class="google-things">

      <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-5130799763611680"
     data-ad-slot="1525472392"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  </div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'tysoncadenhead';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                    
                
            </div>
        </div>
        <script data-main="/js/app.js" src="/js/vendor/require.js"></script>
        <div class="footer">
                <div class="container">
                    <div class="addthis_default_style span12 addthis_32x32_style">
                        <a class="addthis_button_facebook_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_twitter_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_linkedin_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_google_follow" addthis:userid="tysoncadenhead"></a>
                        <a class="addthis_button_youtube_follow" addthis:userid="tysoncadenhead"></a>
                        <a href="http://tysoncadenhead.deviantart.com/gallery/" title="Deviant Art" target="_blank" class="deviant-art"></a>
                        <a class="addthis_button_flickr_follow" addthis:userid="tysonlloydcadenhead"></a>
                        <a class="addthis_button_instagram_follow" addthis:userid="tysoncadenhead"></a>
                    </div>
                    <div class="span12" id="twitter-feed">
                        <a class="twitter-timeline" href="https://twitter.com/tysoncadenhead" data-widget-id="377141114454564864">Tweets by @tysoncadenhead</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
                        <script type="text/javascript">
                            window.tysonJS = {
                                slug: ''
                            };
                        </script>
                    </div>
                </div>
        </div>
    </body>
</html>